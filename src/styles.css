@import url("https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;500&family=Manrope:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap");

@tailwind base;
@tailwind components;
@tailwind utilities;

/* ── Theme variable definitions ── */

:root,
[data-theme="dark"] {
  color-scheme: dark;

  --ink-50: 248 248 250;
  --ink-100: 238 239 242;
  --ink-200: 221 221 226;
  --ink-300: 197 197 204;
  --ink-400: 154 154 163;
  --ink-500: 107 107 115;
  --ink-600: 74 74 78;
  --ink-700: 54 54 56;
  --ink-800: 38 38 40;
  --ink-900: 26 26 28;
  --ink-950: 19 19 20;

  --canvas-bg: 19 19 20;
  --glass-bg: 19 19 20;
  --glass-opacity: 0.72;
  --glass-dense-opacity: 0.82;
  --scrollbar-thumb: rgba(255, 255, 255, 0.08);
  --scrollbar-thumb-hover: rgba(255, 255, 255, 0.15);
  --selection-color: 248 248 250;
  --canvas-gradient-ember: rgba(217, 119, 87, 0.025);
  --canvas-gradient-ink: rgba(154, 154, 163, 0.012);
  --dot-grid-color: 154 154 163;
  --dot-grid-alpha: 0.09;
  --panel-shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.2);
  --accent-active-fg: #f5bda8;
  --accent-active-fg-strong: #ec9a7d;
  --toolbar-active-pill: rgb(var(--ink-700) / 0.7);
  --seg-track: rgb(var(--ink-900) / 0.8);
  --seg-pill: rgb(var(--ink-700) / 0.7);
  --seg-pill-shadow: none;
  --card-surface: rgb(var(--ink-900) / 0.95);
  --card-border: rgb(var(--ink-700));
  --card-border-hover: rgb(var(--ink-600));
  --btn-secondary-bg: rgb(var(--ink-800));
  --btn-secondary-bg-hover: rgb(var(--ink-700));
  --btn-secondary-border: rgb(var(--ink-700) / 0.5);
  --divider: rgb(var(--ink-800) / 0.6);
  --surface-raised: rgb(var(--ink-900) / 0.35);
  --surface-inset: rgb(var(--ink-950) / 0.55);
  --surface-overlay: rgb(var(--ink-950) / 0.8);
  --input-bg: rgb(var(--ink-950) / 0.6);
  --input-border: rgb(var(--ink-800));
  --tooltip-bg: rgb(var(--ink-800));
  --tooltip-fg: rgb(var(--ink-100));
  --badge-neutral-bg: rgb(var(--ink-800));
  --kbd-bg: rgb(var(--ink-950) / 0.7);
  --kbd-border: rgb(var(--ink-600) / 0.4);
  --switch-track: rgb(var(--ink-700));
  --panel-border: rgb(var(--ink-700) / 0.4);
}

[data-theme="light"] {
  color-scheme: light;

  --ink-50: 19 19 20;
  --ink-100: 26 26 28;
  --ink-200: 38 38 40;
  --ink-300: 54 54 56;
  --ink-400: 74 74 78;
  --ink-500: 107 107 115;
  --ink-600: 154 154 163;
  --ink-700: 195 194 200;
  --ink-800: 218 216 207;
  --ink-900: 236 235 226;
  --ink-950: 246 245 237;

  --canvas-bg: 250 249 240;
  --glass-bg: 255 255 255;
  --glass-opacity: 0.92;
  --glass-dense-opacity: 1;
  --scrollbar-thumb: rgba(0, 0, 0, 0.12);
  --scrollbar-thumb-hover: rgba(0, 0, 0, 0.2);
  --selection-color: 250 249 240;
  --canvas-gradient-ember: rgba(217, 119, 87, 0.04);
  --canvas-gradient-ink: rgba(74, 74, 78, 0.02);
  --dot-grid-color: 74 74 78;
  --dot-grid-alpha: 0.1;
  --panel-shadow: 0 1px 3px rgba(0, 0, 0, 0.1), 0 4px 16px rgba(0, 0, 0, 0.07);
  --accent-active-fg: #a2523a;
  --accent-active-fg-strong: #c46849;
  --toolbar-active-pill: rgb(var(--ink-600) / 0.10);
  --seg-track: rgb(var(--ink-700) / 0.35);
  --seg-pill: rgba(255, 255, 255, 1);
  --seg-pill-shadow: 0 1px 3px rgba(0, 0, 0, 0.10), 0 0 0 1px rgba(0, 0, 0, 0.04);
  --card-surface: rgba(255, 255, 255, 0.95);
  --card-border: rgba(0, 0, 0, 0.10);
  --card-border-hover: rgba(0, 0, 0, 0.18);
  --btn-secondary-bg: rgba(255, 255, 255, 0.9);
  --btn-secondary-bg-hover: rgba(255, 255, 255, 1);
  --btn-secondary-border: rgb(var(--ink-700) / 0.5);
  --divider: rgba(0, 0, 0, 0.08);
  --surface-raised: rgba(0, 0, 0, 0.03);
  --surface-inset: rgba(0, 0, 0, 0.04);
  --surface-overlay: rgba(0, 0, 0, 0.05);
  --input-bg: rgba(255, 255, 255, 0.8);
  --input-border: rgba(0, 0, 0, 0.15);
  --tooltip-bg: rgb(30 30 32 / 0.95);
  --tooltip-fg: rgb(248 248 250);
  --badge-neutral-bg: rgba(0, 0, 0, 0.06);
  --kbd-bg: rgba(0, 0, 0, 0.05);
  --kbd-border: rgba(0, 0, 0, 0.12);
  --switch-track: rgba(0, 0, 0, 0.16);
  --panel-border: rgba(0, 0, 0, 0.08);
}

@layer base {
  * {
    @apply border-ink-800;
    scrollbar-width: thin;
    scrollbar-color: var(--scrollbar-thumb) transparent;
  }

  *:focus:not(:focus-visible) {
    outline: none;
  }

  *:focus-visible {
    outline: 2px solid rgba(217, 119, 87, 0.55);
    outline-offset: 2px;
  }

  button,
  a,
  input,
  select,
  textarea,
  summary {
    -webkit-tap-highlight-color: rgba(217, 119, 87, 0.22);
  }

  *::-webkit-scrollbar {
    width: 6px;
    height: 6px;
  }

  *::-webkit-scrollbar-track {
    background: transparent;
  }

  *::-webkit-scrollbar-thumb {
    background: var(--scrollbar-thumb);
    border-radius: 999px;
  }

  *::-webkit-scrollbar-thumb:hover {
    background: var(--scrollbar-thumb-hover);
  }

  body {
    @apply m-0 font-body text-ink-50 antialiased;
    background-color: rgb(var(--canvas-bg));
  }

  ::selection {
    background: rgba(217, 119, 87, 0.35);
    color: rgb(var(--selection-color));
  }
}

.bg-canvas {
  background-color: rgb(var(--canvas-bg));
  background-image:
    radial-gradient(circle at 0% 0%, var(--canvas-gradient-ember), transparent 50%),
    radial-gradient(circle at 100% 100%, var(--canvas-gradient-ink), transparent 50%);
}

.ambient-orb {
  position: absolute;
  border-radius: 999px;
  filter: blur(100px);
  pointer-events: none;
  opacity: 0.35;
}

.ambient-orb-a {
  width: 500px;
  height: 500px;
  top: -260px;
  left: -160px;
  background: rgba(217, 119, 87, 0.045);
}

.ambient-orb-b {
  width: 500px;
  height: 500px;
  bottom: -280px;
  right: -180px;
  background: rgba(154, 154, 163, 0.025);
}

.glass-panel {
  background: rgb(var(--glass-bg) / var(--glass-opacity));
  -webkit-backdrop-filter: blur(20px) saturate(1.3);
  backdrop-filter: blur(20px) saturate(1.3);
}

.glass-panel-dense {
  background: rgb(var(--glass-bg) / var(--glass-dense-opacity));
  -webkit-backdrop-filter: blur(16px) saturate(1.2);
  backdrop-filter: blur(16px) saturate(1.2);
}

/* ── Canvas running / paused border ── */

.canvas-run-overlay {
  transition: border-color 0.5s ease;
  transform: translateZ(0);
}

/* ── Running ── */

.canvas-run-overlay.is-running {
  border-color: rgba(217, 119, 87, 0.32);
  animation: canvas-border-glow 3s ease-in-out infinite;
  animation-delay: 0.9s;
  animation-fill-mode: backwards;
  transition: border-color 0.6s ease 0.8s;
}

@keyframes canvas-border-glow {
  0%, 100% {
    border-color: rgba(217, 119, 87, 0.36);
  }
  50% {
    border-color: rgba(217, 119, 87, 0.18);
  }
}

/* ── Paused ── */

.canvas-run-overlay.is-paused {
  border-color: rgba(245, 158, 11, 0.3);
  animation: canvas-border-paused 4s ease-in-out infinite;
  transition: border-color 0.8s ease;
}

@keyframes canvas-border-paused {
  0%, 100% {
    border-color: rgba(245, 158, 11, 0.3);
  }
  50% {
    border-color: rgba(245, 158, 11, 0.15);
  }
}

/* ── Light mode ── */

[data-theme="light"] .canvas-run-overlay.is-running {
  border-color: rgba(196, 104, 73, 0.5);
  animation-name: canvas-border-glow-light;
  animation-delay: 0.9s;
  animation-fill-mode: backwards;
  transition: border-color 0.6s ease 0.8s;
}

@keyframes canvas-border-glow-light {
  0%, 100% {
    border-color: rgba(196, 104, 73, 0.56);
  }
  50% {
    border-color: rgba(196, 104, 73, 0.28);
  }
}

[data-theme="light"] .canvas-run-overlay.is-paused {
  border-color: rgba(217, 119, 11, 0.4);
  animation-name: canvas-border-paused-light;
}

@keyframes canvas-border-paused-light {
  0%, 100% {
    border-color: rgba(217, 119, 11, 0.4);
  }
  50% {
    border-color: rgba(217, 119, 11, 0.2);
  }
}

/* ── Animated border glow ── */

.node-border-glow {
  --glow-fade: 0;
  isolation: isolate;
}

.node-border-glow.glow-active {
  --glow-fade: 1;
}

.node-running-tint {
  background-color: rgba(217, 119, 87, 0.035) !important;
}

[data-theme="light"] .node-running-tint {
  background-color: rgba(196, 104, 73, 0.04) !important;
}

[data-theme="dark"] .pipeline-node-surface {
  background-color: rgb(25 25 27);
}

.node-border-glow::before {
  content: "";
  position: absolute;
  inset: -2px;
  border-radius: inherit;
  padding: 1.5px;
  background: conic-gradient(
    from var(--border-angle, 0deg),
    rgba(217, 119, 87, 0.95) 0%,
    rgba(236, 154, 125, 0.6) 5%,
    rgba(217, 119, 87, 0.25) 12%,
    rgba(217, 119, 87, 0.06) 20%,
    rgba(217, 119, 87, 0.06) 35%,
    rgba(217, 119, 87, 0.65) 48%,
    rgba(236, 154, 125, 0.45) 52%,
    rgba(217, 119, 87, 0.2) 60%,
    rgba(217, 119, 87, 0.06) 68%,
    rgba(217, 119, 87, 0.06) 88%,
    rgba(217, 119, 87, 0.25) 94%,
    rgba(217, 119, 87, 0.95) 100%
  );
  -webkit-mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  -webkit-mask-composite: xor;
  mask:
    linear-gradient(#fff 0 0) content-box,
    linear-gradient(#fff 0 0);
  mask-composite: exclude;
  pointer-events: none;
  z-index: -1;
  opacity: var(--glow-fade);
  transition: opacity 0.8s ease;
}

.node-border-glow::after {
  content: "";
  position: absolute;
  inset: -4px;
  border-radius: inherit;
  opacity: calc(var(--glow-opacity, 0) * var(--glow-fade));
  box-shadow:
    0 0 18px 4px rgba(217, 119, 87, 0.28),
    0 0 40px 8px rgba(217, 119, 87, 0.08);
  pointer-events: none;
  z-index: -2;
  transition: opacity 0.8s ease;
}

/* ── Light-mode node glow overrides ── */

[data-theme="light"] .node-border-glow::before {
  background: conic-gradient(
    from var(--border-angle, 0deg),
    rgba(196, 104, 73, 1) 0%,
    rgba(217, 119, 87, 0.75) 5%,
    rgba(196, 104, 73, 0.4) 12%,
    rgba(196, 104, 73, 0.08) 20%,
    rgba(196, 104, 73, 0.08) 35%,
    rgba(196, 104, 73, 0.8) 48%,
    rgba(217, 119, 87, 0.55) 52%,
    rgba(196, 104, 73, 0.3) 60%,
    rgba(196, 104, 73, 0.08) 68%,
    rgba(196, 104, 73, 0.08) 88%,
    rgba(196, 104, 73, 0.35) 94%,
    rgba(196, 104, 73, 1) 100%
  );
}

[data-theme="light"] .node-border-glow::after {
  box-shadow:
    0 0 20px 5px rgba(196, 104, 73, 0.22),
    0 0 44px 10px rgba(196, 104, 73, 0.07);
}

/* ── Theme-aware icon inversion ── */

[data-theme="dark"] .icon-invert-dark {
  filter: brightness(0) invert(1);
}
